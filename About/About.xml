<?xml version="1.0" encoding="utf-8"?>
<ModMetaData>
	<packageId>nitoritech.rimtalk.tts</packageId>
	<name>RimTalk TTS Addon</name>
	<author>Nitori_Tachyon</author>
	<description>Text-to-Speech extension for RimTalk that brings your colonists' voices to life!

[url=https://github.com/whatismyname0/RimTalkTTSModule]Github[/url]
[url=https://tieba.baidu.com/p/10278651916]Install tutorial (Baidu Tieba in Chinese)[/url]
[url=https://www.bilibili.com/video/BV1PB2fBsEtQ]Preview video (Bilibili)[/url]

This mod captures dialogue generated by RimTalk and converts it to speech. Features include:

[h2]Feature[/h2]

[list]
[*]Real-time speech synthesis for all RimTalk dialogues
[*]Per-pawn voice model configuration
[*]Customize voice models
[*]Support Fish Audio, CosyVoice2(SiliconFlow) &amp; IndexTTS2(SiliconFlow)
[*]Translation support for multilingual speech
[*]Automatic dialogue blocking until speech is ready
[*]Turn on and off anytime
[*]Synchronized cancellation when RimTalk ignores dialogue
[*]Configurable voice parameters (temperature, top_p) (Available only for fish audio)
[*]Volume control
[*]Button to ignore all existing Rimtalk dialogues
[*]Button to generate a round of new Rimtalk dialogue
[/list]

[h2]Requirements[/h2]

[list]
[*]RimTalk must be installed and enabled
[*]It is recommended to disable "Allow Simultaneous Conversations" setting in Rimtalk
[/list]

[h3]Fish Audio Requirements[/h3]

[list]
[*]Python 3.9+ with fish-audio-sdk package installed
[*][url=https://fish.audio/]Fish Audio[/url] API key
[*]Voice reference ID (can be found on fish audio website by clicking "share" button of the voice model you want to add, then delete "https://fish.audio/m/") for speech generation
[/list]

[h3]CosyVoice2 &amp; IndexTTS2 Requirements[/h3]

[list]
[*][url=https://www.siliconflow.cn/]SiliconFlow[/url] API key
[*](Optional)Voice references for CosyVoice2 and IndexTTS2(Add them through in-game mod option menu)
[*](Optional)Verify your real world indentity to use custom voices
[/list]

[h2]Setup[/h2]

[olist]
[*]Enable both RimTalk and RimTalk TTS mods
[*]Configure TTS model and input text process model settings in mod options
[*]Assign voice models to your colonists
[/olist]

[h2]ATTENTION[/h2]: When using Alt+F4 to close the game, RimTalk TTS may not shutdown the server.
This mod operates non-invasively through Harmony patches and does not modify RimTalk's core code.

[h2]Recommended prompt for TTS input pre-process (Fish Audio)[/h2]
You are to process input text for a TTS (text-to-speech) model.
- Translate the text into {language}
- Emotions: must appear at the beginning of a sentence, only one per sentence, and separated from the sentence by a single space.
- Tone markers: may appear anywhere.
- Audio effects: may be placed in appropriate positions, and you may add suitable verbal descriptions after an effect marker (for example, after (laughing) add "haha", after (groaning) add "aah", etc.).
- All annotations may be combined.
- DELETE ALL NON-VERBAL CONTENT IN RAW INPUT
- Replace ellipses with (break) or (long-break).
- Append (break) after EVERY sentences

- ONLY ANNOTATIONS LISTED BELOW IS ALLOWED

EMOTIONS:
(happy), (sad), (angry), (excited), (calm), (nervous), (confident), (surprised), (satisfied), (delighted), (scared), (worried), (upset), (frustrated), (depressed), (empathetic), (embarrassed), (disgusted), (moved), (proud), (relaxed), (grateful), (curious), (sarcastic), (disdainful), (unhappy), (anxious), (hysterical), (indifferent), (uncertain), (doubtful), (confused), (disappointed), (regretful), (guilty), (ashamed), (jealous), (envious), (hopeful), (optimistic), (pessimistic), (nostalgic), (lonely), (bored), (contemptuous), (sympathetic), (compassionate), (determined), (resigned)

TONE MARKERS:
(in a hurry tone), (shouting), (screaming), (whispering), (soft tone)

AUDIO EFFECTS:
(laughing), (chuckling), (sobbing), (crying loudly), (sighing), (groaning), (panting), (gasping), (yawning), (snoring)
Special AUDIO EFFECTS: (break) for short pause, (long-break) for long pause

INTENSITY MODIFIERS:
Adjust emotions: (slightly sad), (very excited), (extremely angry) etc.

Only output the final translated words in {language} with markers in English, and nothing else.
- output MUST contain only speech, words that indicate vocalizations, and annotations you add.
- DELETE ALL NON-VERBAL CONTENT IN RAW INPUT

- DELETE (nostalgic), (determined) and (concerned)
- ANNOTATIONS NOT LISTED ABOVE IS NOT ALLOWED

input:

{text}

[h2]Recommended prompt sentences for TTS input pre-process (CosyVoice2)[/h2]
你需要为cosyvoice2对需要进行TTS的文本进行预处理。
你需要根据文本内容，决定prompt，包括语气、情绪、速度与说话人的风格、情感。
prompt应位于输出的开头，与文本以&lt;|endofprompt|&gt;隔开。
你需要删除原始文本中所有描写性质的内容，只留下语言。
输出文本中，在合适地方可添加以下符号，但必须符合原文本的情绪与内容：[breath],&lt;strong&gt;&lt;/strong&gt;(此符号会将它们括起的内容语气增强),[noise],[laughter],[cough],[clucking],[accent],[quick_breath],&lt;laughter>&lt;/laughter&gt;(此符号会将它们括起的内容带上笑意),[hissing],[sigh],[vocalized-noise],[lipsmack]
你必须按照以上给定的要求输出prompt(中文)与经过处理与符号添加后的文本(必须翻译成{language})。
文本如下：

{text}
	</description>
	<supportedVersions>
		<li>1.6</li>
	</supportedVersions>
	<modDependencies>
		<li>
			<packageId>brrainz.harmony</packageId>
			<displayName>Harmony</displayName>
			<steamWorkshopUrl>steam://url/CommunityFilePage/2009463077</steamWorkshopUrl>
			<downloadUrl>https://github.com/pardeike/HarmonyRimWorld/releases/latest</downloadUrl>
		</li>
		<li>
			<packageId>cj.rimtalk</packageId>
			<displayName>RimTalk</displayName>
			<steamWorkshopUrl>steam://url/CommunityFilePage/3551203752</steamWorkshopUrl>
			<downloadUrl>https://github.com/jlibrary/RimTalk/</downloadUrl>
		</li>
	</modDependencies>
	<loadAfter>
		<li>brrainz.harmony</li>
		<li>cj.rimtalk</li>
	</loadAfter>
</ModMetaData>
